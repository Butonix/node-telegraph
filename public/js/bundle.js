!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=2)}([function(e,t,n){var r,o;!function(i,a){r=i,void 0!==(o="function"==typeof r?r.call(t,n,t,e):r)&&(e.exports=o)}(function(){function e(e,t){var n=typeof e[t];return n==N||!(n!=R||!e[t])||"unknown"==n}function t(e,t){return!(typeof e[t]!=R||!e[t])}function n(e,t){return typeof e[t]!=E}function r(e){return function(t,n){for(var r=n.length;r--;)if(!e(t,n[r]))return!1;return!0}}function o(e){return e&&b(e,w)&&x(e,S)}function i(e){return t(e,"body")?e.body:e.getElementsByTagName("body")[0]}function a(t){typeof console!=E&&e(console,"log")&&console.log(t)}function s(e,t){D&&t?alert(e):a(e)}function c(e){H.initialized=!0,H.supported=!1,s("Rangy is not supported in this environment. Reason: "+e,H.config.alertOnFail)}function l(e){s("Rangy warning: "+e,H.config.alertOnWarn)}function d(e){return e.message||e.description||String(e)}function u(){if(D&&!H.initialized){var t,n=!1,r=!1;e(document,"createRange")&&(t=document.createRange(),b(t,T)&&x(t,y)&&(n=!0));var s=i(document);if(!s||"body"!=s.nodeName.toLowerCase())return void c("No body element found");if(s&&e(s,"createTextRange")&&(t=s.createTextRange(),o(t)&&(r=!0)),!n&&!r)return void c("Neither Range nor TextRange are available");H.initialized=!0,H.features={implementsDomRange:n,implementsTextRange:r};var l,u;for(var f in _)(l=_[f])instanceof p&&l.init(l,H);for(var h=0,g=M.length;h<g;++h)try{M[h](H)}catch(e){u="Rangy init listener threw an exception. Continuing. Detail: "+d(e),a(u)}}}function f(e,t,n){n&&(e+=" in module "+n.name),H.warn("DEPRECATED: "+e+" is deprecated. Please use "+t+" instead.")}function h(e,t,n,r){e[t]=function(){return f(t,n,r),e[n].apply(e,P.toArray(arguments))}}function g(e){e=e||window,u();for(var t=0,n=I.length;t<n;++t)I[t](e)}function p(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function m(e,t,n){var r=new p(e,t,function(t){if(!t.initialized){t.initialized=!0;try{n(H,t),t.supported=!0}catch(t){var r="Module '"+e+"' failed to load: "+d(t);a(r),t.stack&&a(t.stack)}}});return _[e]=r,r}function v(){}function C(){}var R="object",N="function",E="undefined",y=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],T=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],S=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],w=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],b=r(e),A=r(t),x=r(n),O=[].forEach?function(e,t){e.forEach(t)}:function(e,t){for(var n=0,r=e.length;n<r;++n)t(e[n],n)},_={},D=typeof window!=E&&typeof document!=E,P={isHostMethod:e,isHostObject:t,isHostProperty:n,areHostMethods:b,areHostObjects:A,areHostProperties:x,isTextRange:o,getBody:i,forEach:O},H={version:"1.3.0",initialized:!1,isBrowser:D,supported:!0,util:P,features:{},modules:_,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==E||rangyAutoInitialize}};H.fail=c,H.warn=l;var k;!{}.hasOwnProperty?c("hasOwnProperty not supported"):(P.extend=k=function(e,t,n){var r,o;for(var i in t)t.hasOwnProperty(i)&&(r=e[i],o=t[i],n&&null!==r&&"object"==typeof r&&null!==o&&"object"==typeof o&&k(r,o,!0),e[i]=o);return t.hasOwnProperty("toString")&&(e.toString=t.toString),e},P.createOptions=function(e,t){var n={};return k(n,t),e&&k(n,e),n}),D||c("Rangy can only run in a browser"),function(){var e;if(D){var t=document.createElement("div");t.appendChild(document.createElement("span"));var n=[].slice;try{1==n.call(t.childNodes,0)[0].nodeType&&(e=function(e){return n.call(e,0)})}catch(e){}}e||(e=function(e){for(var t=[],n=0,r=e.length;n<r;++n)t[n]=e[n];return t}),P.toArray=e}();var L;D&&(e(document,"addEventListener")?L=function(e,t,n){e.addEventListener(t,n,!1)}:e(document,"attachEvent")?L=function(e,t,n){e.attachEvent("on"+t,n)}:c("Document does not have required addEventListener or attachEvent method"),P.addListener=L);var M=[];P.deprecationNotice=f,P.createAliasForDeprecatedMethod=h,H.init=u,H.addInitListener=function(e){H.initialized?e(H):M.push(e)};var I=[];H.addShimListener=function(e){I.push(e)},D&&(H.shim=H.createMissingNativeApi=g,h(H,"createMissingNativeApi","shim")),p.prototype={init:function(){for(var e,t,n=this.dependencies||[],r=0,o=n.length;r<o;++r){if(t=n[r],!((e=_[t])&&e instanceof p))throw new Error("required module '"+t+"' not found");if(e.init(),!e.supported)throw new Error("required module '"+t+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error(e)},warn:function(e){H.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){H.warn("DEPRECATED: "+e+" in module "+this.name+" is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},H.createModule=function(e){var t,n;2==arguments.length?(t=arguments[1],n=[]):(t=arguments[2],n=arguments[1]);var r=m(e,n,t);H.initialized&&H.supported&&r.init()},H.createCoreModule=function(e,t,n){m(e,t,n)},H.RangePrototype=v,H.rangePrototype=new v,H.selectionPrototype=new C,H.createCoreModule("DomUtil",[],function(e,t){function n(e){var t;return typeof e.namespaceURI==D||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t}function r(e){var t=e.parentNode;return 1==t.nodeType?t:null}function o(e){for(var t=0;e=e.previousSibling;)++t;return t}function i(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function a(e,t){var n,r=[];for(n=e;n;n=n.parentNode)r.push(n);for(n=t;n;n=n.parentNode)if(M(r,n))return n;return null}function s(e,t,n){for(var r=n?t:t.parentNode;r;){if(r===e)return!0;r=r.parentNode}return!1}function c(e,t){return s(e,t,!0)}function l(e,t,n){for(var r,o=n?e:e.parentNode;o;){if((r=o.parentNode)===t)return o;o=r}return null}function d(e){var t=e.nodeType;return 3==t||4==t||8==t}function u(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t}function f(e,t){var n=t.nextSibling,r=t.parentNode;return n?r.insertBefore(e,n):r.appendChild(e),e}function h(e,t,n){var r=e.cloneNode(!1);if(r.deleteData(0,t),e.deleteData(t,e.length-t),f(r,e),n)for(var i,a=0;i=n[a++];)i.node==e&&i.offset>t?(i.node=r,i.offset-=t):i.node==e.parentNode&&i.offset>o(e)&&++i.offset;return r}function g(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=D)return e.ownerDocument;if(typeof e.document!=D)return e.document;if(e.parentNode)return g(e.parentNode);throw t.createError("getDocument: no document found for node")}function p(e){var n=g(e);if(typeof n.defaultView!=D)return n.defaultView;if(typeof n.parentWindow!=D)return n.parentWindow;throw t.createError("Cannot get a window object for node")}function m(e){if(typeof e.contentDocument!=D)return e.contentDocument;if(typeof e.contentWindow!=D)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function v(e){if(typeof e.contentWindow!=D)return e.contentWindow;if(typeof e.contentDocument!=D)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")}function C(e){return e&&P.isHostMethod(e,"setTimeout")&&P.isHostObject(e,"document")}function R(e,t,n){var r;if(e?P.isHostProperty(e,"nodeType")?r=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?m(e):g(e):C(e)&&(r=e.document):r=document,!r)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return r}function N(e){for(var t;t=e.parentNode;)e=t;return e}function E(e,n,r,i){var s,c,d,u,f;if(e==r)return n===i?0:n<i?-1:1;if(s=l(r,e,!0))return n<=o(s)?-1:1;if(s=l(e,r,!0))return o(s)<i?-1:1;if(!(c=a(e,r)))throw new Error("comparePoints error: nodes have no common ancestor");if(d=e===c?c:l(e,c,!0),u=r===c?c:l(r,c,!0),d===u)throw t.createError("comparePoints got to case 4 and childA and childB are the same!");for(f=c.firstChild;f;){if(f===d)return-1;if(f===u)return 1;f=f.nextSibling}}function y(e){try{return e.parentNode,!1}catch(e){return!0}}function T(e){if(!e)return"[No node]";if(I&&y(e))return"[Broken node]";if(d(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">[index:"+o(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function S(e){for(var t,n=g(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n}function w(e,t,n){var r=H(e),o=e.createElement("div");o.contentEditable=""+!!n,t&&(o.innerHTML=t);var i=r.firstChild;return i?r.insertBefore(o,i):r.appendChild(o),o}function b(e){return e.parentNode.removeChild(e)}function A(e){this.root=e,this._next=e}function x(e){return new A(e)}function O(e,t){this.node=e,this.offset=t}function _(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var D="undefined",P=e.util,H=P.getBody;P.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),P.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var k=document.createElement("div");P.areHostMethods(k,["insertBefore","appendChild","cloneNode"]||!P.areHostObjects(k,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),P.isHostProperty(k,"innerHTML")||t.fail("Element is missing innerHTML property");var L=document.createTextNode("test");P.areHostMethods(L,["splitText","deleteData","insertData","appendData","cloneNode"]||!P.areHostObjects(k,["previousSibling","nextSibling","childNodes","parentNode"])||!P.areHostProperties(L,["data"]))||t.fail("Incomplete Text Node implementation");var M=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1},I=!1;!function(){var t=document.createElement("b");t.innerHTML="1";var n=t.firstChild;t.innerHTML="<br />",I=y(n),e.features.crashyTextNodes=I}();var B;typeof window.getComputedStyle!=D?B=function(e,t){return p(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=D?B=function(e,t){return e.currentStyle?e.currentStyle[t]:""}:t.fail("No means of obtaining computed style properties found"),A.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},O.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+T(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},_.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},_.prototype.toString=function(){return this.message},e.dom={arrayContains:M,isHtmlNamespace:n,parentElement:r,getNodeIndex:o,getNodeLength:i,getCommonAncestor:a,isAncestorOf:s,isOrIsAncestorOf:c,getClosestAncestorIn:l,isCharacterDataNode:d,isTextOrCommentNode:u,insertAfter:f,splitDataNode:h,getDocument:g,getWindow:p,getIframeWindow:v,getIframeDocument:m,getBody:H,isWindow:C,getContentDocument:R,getRootContainer:N,comparePoints:E,isBrokenNode:y,inspectNode:T,getComputedStyleProperty:B,createTestElement:w,removeNode:b,fragmentFromNodeChildren:S,createIterator:x,DomPosition:O},e.DOMException=_}),H.createCoreModule("DomRange",["DomUtil"],function(e,t){function n(e,t){return 3!=e.nodeType&&(j(e,t.startContainer)||j(e,t.endContainer))}function r(e){return e.document||z(e.startContainer)}function o(e){return $(e.startContainer)}function i(e){return new I(e.parentNode,U(e))}function a(e){return new I(e.parentNode,U(e)+1)}function s(e,t,n){var r=11==e.nodeType?e.firstChild:e;return W(t)?n==t.length?L.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:V(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),r}function c(e,t,n){if(w(e),w(t),r(t)!=r(e))throw new B("WRONG_DOCUMENT_ERR");var o=F(e.startContainer,e.startOffset,t.endContainer,t.endOffset),i=F(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return n?o<=0&&i>=0:o<0&&i>0}function l(e){for(var t,n,o,i=r(e.range).createDocumentFragment();n=e.next();){if(t=e.isPartiallySelectedSubtree(),n=n.cloneNode(!t),t&&(o=e.getSubtreeIterator(),n.appendChild(l(o)),o.detach()),10==n.nodeType)throw new B("HIERARCHY_REQUEST_ERR");i.appendChild(n)}return i}function d(e,t,n){var r,o;n=n||{stop:!1};for(var i,a;i=e.next();)if(e.isPartiallySelectedSubtree()){if(!1===t(i))return void(n.stop=!0);if(a=e.getSubtreeIterator(),d(a,t,n),a.detach(),n.stop)return}else for(r=L.createIterator(i);o=r.next();)if(!1===t(o))return void(n.stop=!0)}function u(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),u(t),t.detach()):e.remove()}function f(e){for(var t,n,o=r(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),n=e.getSubtreeIterator(),t.appendChild(f(n)),n.detach()):e.remove(),10==t.nodeType)throw new B("HIERARCHY_REQUEST_ERR");o.appendChild(t)}return o}function h(e,t,n){var r,o=!(!t||!t.length),i=!!n;o&&(r=new RegExp("^("+t.join("|")+")$"));var a=[];return d(new p(e,!1),function(t){if((!o||r.test(t.nodeType))&&(!i||n(t))){var s=e.startContainer;if(t!=s||!W(s)||e.startOffset!=s.length){var c=e.endContainer;t==c&&W(c)&&0==e.endOffset||a.push(t)}}}),a}function g(e){return"["+(void 0===e.getName?"Range":e.getName())+"("+L.inspectNode(e.startContainer)+":"+e.startOffset+", "+L.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function p(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&W(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||W(this.sc)?q(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||W(this.ec)?q(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}function m(e){return function(t,n){for(var r,o=n?t:t.parentNode;o;){if(r=o.nodeType,Y(e,r))return o;o=o.parentNode}return null}}function v(e,t){if(oe(e,t))throw new B("INVALID_NODE_TYPE_ERR")}function C(e,t){if(!Y(t,e.nodeType))throw new B("INVALID_NODE_TYPE_ERR")}function R(e,t){if(t<0||t>(W(e)?e.length:e.childNodes.length))throw new B("INDEX_SIZE_ERR")}function N(e,t){if(ne(e,!0)!==ne(t,!0))throw new B("WRONG_DOCUMENT_ERR")}function E(e){if(re(e,!0))throw new B("NO_MODIFICATION_ALLOWED_ERR")}function y(e,t){if(!e)throw new B(t)}function T(e,t){return t<=(W(e)?e.length:e.childNodes.length)}function S(e){return!!e.startContainer&&!!e.endContainer&&!(Q&&(L.isBrokenNode(e.startContainer)||L.isBrokenNode(e.endContainer)))&&$(e.startContainer)==$(e.endContainer)&&T(e.startContainer,e.startOffset)&&T(e.endContainer,e.endOffset)}function w(e){if(!S(e))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+e.inspect()+")")}function b(e,t){w(e);var n=e.startContainer,r=e.startOffset,o=e.endContainer,i=e.endOffset,a=n===o;W(o)&&i>0&&i<o.length&&V(o,i,t),W(n)&&r>0&&r<n.length&&(n=V(n,r,t),a?(i-=r,o=n):o==n.parentNode&&i>=U(n)&&i++,r=0),e.setStartAndEnd(n,r,o,i)}function A(e){w(e);var t=e.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(e.cloneContents()),t.innerHTML}function x(e){e.START_TO_START=le,e.START_TO_END=de,e.END_TO_END=ue,e.END_TO_START=fe,e.NODE_BEFORE=he,e.NODE_AFTER=ge,e.NODE_BEFORE_AND_AFTER=pe,e.NODE_INSIDE=me}function O(e){x(e),x(e.prototype)}function _(e,t){return function(){w(this);var n,r,o=this.startContainer,i=this.startOffset,s=this.commonAncestorContainer,c=new p(this,!0);o!==s&&(n=q(o,s,!0),r=a(n),o=r.node,i=r.offset),d(c,E),c.reset();var l=e(c);return c.detach(),t(this,o,i,o,i),l}}function D(t,r){function o(e,t){return function(n){C(n,X),C($(n),Z);var r=(e?i:a)(n);(t?s:c)(this,r.node,r.offset)}}function s(e,t,n){var o=e.endContainer,i=e.endOffset;t===e.startContainer&&n===e.startOffset||($(t)==$(o)&&1!=F(t,n,o,i)||(o=t,i=n),r(e,t,n,o,i))}function c(e,t,n){var o=e.startContainer,i=e.startOffset;t===e.endContainer&&n===e.endOffset||($(t)==$(o)&&-1!=F(t,n,o,i)||(o=t,i=n),r(e,o,i,t,n))}var l=function(){};l.prototype=e.rangePrototype,t.prototype=new l,M.extend(t.prototype,{setStart:function(e,t){v(e,!0),R(e,t),s(this,e,t)},setEnd:function(e,t){v(e,!0),R(e,t),c(this,e,t)},setStartAndEnd:function(){var e=arguments,t=e[0],n=e[1],o=t,i=n;switch(e.length){case 3:i=e[2];break;case 4:o=e[2],i=e[3]}r(this,t,n,o,i)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:o(!0,!0),setStartAfter:o(!1,!0),setEndBefore:o(!0,!1),setEndAfter:o(!1,!1),collapse:function(e){w(this),e?r(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):r(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){v(e,!0),r(this,e,0,e,K(e))},selectNode:function(e){v(e,!1),C(e,X);var t=i(e),n=a(e);r(this,t.node,t.offset,n.node,n.offset)},extractContents:_(f,r),deleteContents:_(u,r),canSurroundContents:function(){w(this),E(this.startContainer),E(this.endContainer);var e=new p(this,!0),t=e._first&&n(e._first,this)||e._last&&n(e._last,this);return e.detach(),!t},splitBoundaries:function(){b(this)},splitBoundariesPreservingPositions:function(e){b(this,e)},normalizeBoundaries:function(){w(this);var e,t=this.startContainer,n=this.startOffset,o=this.endContainer,i=this.endOffset,a=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(o=e,i=e.length,e.appendData(t.data),G(t))},s=function(e){var r=e.previousSibling;if(r&&r.nodeType==e.nodeType){t=e;var a=e.length;if(n=r.length,e.insertData(0,r.data),G(r),t==o)i+=n,o=t;else if(o==e.parentNode){var s=U(e);i==s?(o=e,i=a):i>s&&i--}}},c=!0;if(W(o))i==o.length?a(o):0==i&&(e=o.previousSibling)&&e.nodeType==o.nodeType&&(i=e.length,t==o&&(c=!1),e.appendData(o.data),G(o),o=e);else{if(i>0){var l=o.childNodes[i-1];l&&W(l)&&a(l)}c=!this.collapsed}if(c){if(W(t))0==n?s(t):n==t.length&&(e=t.nextSibling)&&e.nodeType==t.nodeType&&(o==e&&(o=t,i+=t.length),t.appendData(e.data),G(e));else if(n<t.childNodes.length){var d=t.childNodes[n];d&&W(d)&&s(d)}}else t=o,n=i;r(this,t,n,o,i)},collapseToPoint:function(e,t){v(e,!0),R(e,t),this.setStartAndEnd(e,t)}}),O(t)}function P(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:L.getCommonAncestor(e.startContainer,e.endContainer)}function H(e,t,n,r,o){e.startContainer=t,e.startOffset=n,e.endContainer=r,e.endOffset=o,e.document=L.getDocument(t),P(e)}function k(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,P(this)}var L=e.dom,M=e.util,I=L.DomPosition,B=e.DOMException,W=L.isCharacterDataNode,U=L.getNodeIndex,j=L.isOrIsAncestorOf,z=L.getDocument,F=L.comparePoints,V=L.splitDataNode,q=L.getClosestAncestorIn,K=L.getNodeLength,Y=L.arrayContains,$=L.getRootContainer,Q=e.features.crashyTextNodes,G=L.removeNode;p.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,W(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!W(n)||n!==this.sc&&n!==this.ec?n.parentNode&&G(n):(e=n===this.sc?this.so:0,t=n===this.ec?this.eo:n.length,e!=t&&n.deleteData(e,t-e))},isPartiallySelectedSubtree:function(){return n(this._current,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse(!1);else{e=new k(r(this.range));var t=this._current,n=t,o=0,i=t,a=K(t);j(t,this.sc)&&(n=this.sc,o=this.so),j(t,this.ec)&&(i=this.ec,a=this.eo),H(e,n,o,i,a)}return new p(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var X=[1,3,4,5,7,8,10],Z=[2,9,11],J=[5,6,10,12],ee=[1,3,4,5,7,8,10,11],te=[1,3,4,5,7,8],ne=m([9,11]),re=m(J),oe=m([6,10,12]),ie=document.createElement("style"),ae=!1;try{ie.innerHTML="<b>x</b>",ae=3==ie.firstChild.nodeType}catch(e){}e.features.htmlParsingConforms=ae;var se=ae?function(e){var t=this.startContainer,n=z(t);if(!t)throw new B("INVALID_STATE_ERR");var r=null;return 1==t.nodeType?r=t:W(t)&&(r=L.parentElement(t)),r=null===r||"HTML"==r.nodeName&&L.isHtmlNamespace(z(r).documentElement)&&L.isHtmlNamespace(r)?n.createElement("body"):r.cloneNode(!1),r.innerHTML=e,L.fragmentFromNodeChildren(r)}:function(e){var t=r(this),n=t.createElement("body");return n.innerHTML=e,L.fragmentFromNodeChildren(n)},ce=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],le=0,de=1,ue=2,fe=3,he=0,ge=1,pe=2,me=3;M.extend(e.rangePrototype,{compareBoundaryPoints:function(e,t){w(this),N(this.startContainer,t.startContainer);var n,r,o,i,a=e==fe||e==le?"start":"end",s=e==de||e==le?"start":"end";return n=this[a+"Container"],r=this[a+"Offset"],o=t[s+"Container"],i=t[s+"Offset"],F(n,r,o,i)},insertNode:function(e){if(w(this),C(e,ee),E(this.startContainer),j(e,this.startContainer))throw new B("HIERARCHY_REQUEST_ERR");var t=s(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){w(this);var e,t;if(this.collapsed)return r(this).createDocumentFragment();if(this.startContainer===this.endContainer&&W(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=r(this).createDocumentFragment(),t.appendChild(e),t;var n=new p(this,!0);return e=l(n),n.detach(),e},canSurroundContents:function(){w(this),E(this.startContainer),E(this.endContainer);var e=new p(this,!0),t=e._first&&n(e._first,this)||e._last&&n(e._last,this);return e.detach(),!t},surroundContents:function(e){if(C(e,te),!this.canSurroundContents())throw new B("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);s(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){w(this);for(var e,t=new k(r(this)),n=ce.length;n--;)e=ce[n],t[e]=this[e];return t},toString:function(){w(this);var e=this.startContainer;if(e===this.endContainer&&W(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new p(this,!0);return d(n,function(e){3!=e.nodeType&&4!=e.nodeType||t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){w(this);var t=e.parentNode,n=U(e);if(!t)throw new B("NOT_FOUND_ERR");var r=this.comparePoint(t,n),o=this.comparePoint(t,n+1);return r<0?o>0?pe:he:o>0?ge:me},comparePoint:function(e,t){return w(this),y(e,"HIERARCHY_REQUEST_ERR"),N(e,this.startContainer),F(e,t,this.startContainer,this.startOffset)<0?-1:F(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:se,toHtml:function(){return A(this)},intersectsNode:function(e,t){if(w(this),$(e)!=o(this))return!1;var n=e.parentNode,r=U(e);if(!n)return!0;var i=F(n,r,this.endContainer,this.endOffset),a=F(n,r+1,this.startContainer,this.startOffset);return t?i<=0&&a>=0:i<0&&a>0},isPointInRange:function(e,t){return w(this),y(e,"HIERARCHY_REQUEST_ERR"),N(e,this.startContainer),F(e,t,this.startContainer,this.startOffset)>=0&&F(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return c(this,e,!1)},intersectsOrTouchesRange:function(e){return c(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=F(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=F(this.endContainer,this.endOffset,e.endContainer,e.endOffset),r=this.cloneRange();return-1==t&&r.setStart(e.startContainer,e.startOffset),1==n&&r.setEnd(e.endContainer,e.endOffset),r}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return-1==F(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==F(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new B("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==me},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,K(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var r=n.pop();return t.setEnd(r,r.length),this.containsRange(t)}return this.containsNodeContents(e)},getNodes:function(e,t){return w(this),h(this,e,t)},getDocument:function(){return r(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},getBookmark:function(t){var n=r(this),o=e.createRange(n);t=t||L.getBody(n),o.selectNodeContents(t);var i=this.intersection(o),a=0,s=0;return i&&(o.setEnd(i.startContainer,i.startOffset),a=o.toString().length,s=a+i.toString().length),{start:a,end:s,containerNode:t}},moveToBookmark:function(e){var t=e.containerNode,n=0;this.setStart(t,0),this.collapse(!0);for(var r,o,i,a,s=[t],c=!1,l=!1;!l&&(r=s.pop());)if(3==r.nodeType)o=n+r.length,!c&&e.start>=n&&e.start<=o&&(this.setStart(r,e.start-n),c=!0),c&&e.end>=n&&e.end<=o&&(this.setEnd(r,e.end-n),l=!0),n=o;else for(a=r.childNodes,i=a.length;i--;)s.push(a[i])},getName:function(){return"DomRange"},equals:function(e){return k.rangesEqual(this,e)},isValid:function(){return S(this)},inspect:function(){return g(this)},detach:function(){}}),D(k,H),M.extend(k,{rangeProperties:ce,RangeIterator:p,copyComparisonConstants:O,createPrototypeRange:D,inspect:g,toHtml:A,getRangeDocument:r,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=k}),H.createCoreModule("WrappedRange",["DomRange"],function(e,t){var n,r,o=e.dom,i=e.util,a=o.DomPosition,s=e.DomRange,c=o.getBody,l=o.getContentDocument,d=o.isCharacterDataNode;if(e.features.implementsDomRange&&function(){function r(e){for(var t,n=f.length;n--;)t=f[n],e[t]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function a(e,t,n,r,o){var i=e.startContainer!==t||e.startOffset!=n,a=e.endContainer!==r||e.endOffset!=o,s=!e.equals(e.nativeRange);(i||a||s)&&(e.setEnd(r,o),e.setStart(t,n))}var d,u,f=s.rangeProperties;n=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,r(this)},s.createPrototypeRange(n,a),d=n.prototype,d.selectNode=function(e){this.nativeRange.selectNode(e),r(this)},d.cloneContents=function(){return this.nativeRange.cloneContents()},d.surroundContents=function(e){this.nativeRange.surroundContents(e),r(this)},d.collapse=function(e){this.nativeRange.collapse(e),r(this)},d.cloneRange=function(){return new n(this.nativeRange.cloneRange())},d.refresh=function(){r(this)},d.toString=function(){return this.nativeRange.toString()};var h=document.createTextNode("test");c(document).appendChild(h);var g=document.createRange();g.setStart(h,0),g.setEnd(h,0);try{g.setStart(h,1),d.setStart=function(e,t){this.nativeRange.setStart(e,t),r(this)},d.setEnd=function(e,t){this.nativeRange.setEnd(e,t),r(this)},u=function(e){return function(t){this.nativeRange[e](t),r(this)}}}catch(e){d.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}r(this)},d.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}r(this)},u=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(r){this.nativeRange[t](n),this.nativeRange[e](n)}r(this)}}}d.setStartBefore=u("setStartBefore","setEndBefore"),d.setStartAfter=u("setStartAfter","setEndAfter"),d.setEndBefore=u("setEndBefore","setStartBefore"),d.setEndAfter=u("setEndAfter","setStartAfter"),d.selectNodeContents=function(e){this.setStartAndEnd(e,0,o.getNodeLength(e))},g.selectNodeContents(h),g.setEnd(h,3);var p=document.createRange();p.selectNodeContents(h),p.setEnd(h,4),p.setStart(h,2),-1==g.compareBoundaryPoints(g.START_TO_END,p)&&1==g.compareBoundaryPoints(g.END_TO_START,p)?d.compareBoundaryPoints=function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:d.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var m=document.createElement("div");m.innerHTML="123";var v=m.firstChild,C=c(document);C.appendChild(m),g.setStart(v,1),g.setEnd(v,2),g.deleteContents(),"13"==v.data&&(d.deleteContents=function(){this.nativeRange.deleteContents(),r(this)},d.extractContents=function(){var e=this.nativeRange.extractContents();return r(this),e}),C.removeChild(m),C=null,i.isHostMethod(g,"createContextualFragment")&&(d.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),c(document).removeChild(h),d.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createNativeRange=function(e){return e=l(e,t,"createNativeRange"),e.createRange()}}(),e.features.implementsTextRange){var u=function(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var r=n.parentElement();n=e.duplicate(),n.collapse(!1);var i=n.parentElement(),a=r==i?r:o.getCommonAncestor(r,i);return a==t?a:o.getCommonAncestor(t,a)},f=function(e){return 0==e.compareEndPoints("StartToEnd",e)},h=function(e,t,n,r,i){var s=e.duplicate();s.collapse(n);var c=s.parentElement();if(o.isOrIsAncestorOf(t,c)||(c=t),!c.canHaveHTML){var l=new a(c.parentNode,o.getNodeIndex(c));return{boundaryPosition:l,nodeInfo:{nodeIndex:l.offset,containerElement:l.node}}}var u=o.getDocument(c).createElement("span");u.parentNode&&o.removeNode(u);for(var f,h,g,p,m,v=n?"StartToStart":"StartToEnd",C=i&&i.containerElement==c?i.nodeIndex:0,R=c.childNodes.length,N=R,E=N;;){if(E==R?c.appendChild(u):c.insertBefore(u,c.childNodes[E]),s.moveToElementText(u),0==(f=s.compareEndPoints(v,e))||C==N)break;if(-1==f){if(N==C+1)break;C=E}else N=N==C+1?C:E;E=Math.floor((C+N)/2),c.removeChild(u)}if(m=u.nextSibling,-1==f&&m&&d(m)){s.setEndPoint(n?"EndToStart":"EndToEnd",e);var y;if(/[\r\n]/.test(m.data)){var T=s.duplicate(),S=T.text.replace(/\r\n/g,"\r").length;for(y=T.moveStart("character",S);-1==(f=T.compareEndPoints("StartToEnd",T));)y++,T.moveStart("character",1)}else y=s.text.length;p=new a(m,y)}else h=(r||!n)&&u.previousSibling,g=(r||n)&&u.nextSibling,p=g&&d(g)?new a(g,0):h&&d(h)?new a(h,h.data.length):new a(c,o.getNodeIndex(u));return o.removeNode(u),{boundaryPosition:p,nodeInfo:{nodeIndex:E,containerElement:c}}},g=function(e,t){var n,r,i,a,s=e.offset,l=o.getDocument(e.node),u=c(l).createTextRange(),f=d(e.node);return f?(n=e.node,r=n.parentNode):(a=e.node.childNodes,n=s<a.length?a[s]:null,r=e.node),i=l.createElement("span"),i.innerHTML="&#feff;",n?r.insertBefore(i,n):r.appendChild(i),u.moveToElementText(i),u.collapse(!t),r.removeChild(i),f&&u[t?"moveStart":"moveEnd"]("character",s),u};r=function(e){this.textRange=e,this.refresh()},r.prototype=new s(document),r.prototype.refresh=function(){var e,t,n,r=u(this.textRange);f(this.textRange)?t=e=h(this.textRange,r,!0,!0).boundaryPosition:(n=h(this.textRange,r,!0,!1),e=n.boundaryPosition,t=h(this.textRange,r,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},r.prototype.getName=function(){return"WrappedTextRange"},s.copyComparisonConstants(r);var p=function(e){if(e.collapsed)return g(new a(e.startContainer,e.startOffset),!0);var t=g(new a(e.startContainer,e.startOffset),!0),n=g(new a(e.endContainer,e.endOffset),!1),r=c(s.getRangeDocument(e)).createTextRange();return r.setEndPoint("StartToStart",t),r.setEndPoint("EndToEnd",n),r};if(r.rangeToTextRange=p,r.prototype.toTextRange=function(){return p(this)},e.WrappedTextRange=r,!e.features.implementsDomRange||e.config.preferTextRange){var m=function(e){return e("return this;")()}(Function);void 0===m.Range&&(m.Range=r),e.createNativeRange=function(e){return e=l(e,t,"createNativeRange"),c(e).createTextRange()},e.WrappedRange=r}}e.createRange=function(n){return n=l(n,t,"createRange"),new e.WrappedRange(e.createNativeRange(n))},e.createRangyRange=function(e){return e=l(e,t,"createRangyRange"),new s(e)},i.createAliasForDeprecatedMethod(e,"createIframeRange","createRange"),i.createAliasForDeprecatedMethod(e,"createIframeRangyRange","createRangyRange"),e.addShimListener(function(t){var n=t.document;void 0===n.createRange&&(n.createRange=function(){return e.createRange(n)}),n=t=null})}),H.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(e,t){function n(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function r(e,n){if(e){if(b.isWindow(e))return e;if(e instanceof v)return e.win;var r=b.getContentDocument(e,t,n);return b.getWindow(r)}return window}function o(e){return r(e,"getWinSelection").getSelection()}function i(e){return r(e,"getDocSelection").document.selection}function a(e){var t=!1;return e.anchorNode&&(t=1==b.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t}function s(e,t,n){var r=n?"end":"start",o=n?"start":"end";e.anchorNode=t[r+"Container"],e.anchorOffset=t[r+"Offset"],e.focusNode=t[o+"Container"],e.focusOffset=t[o+"Offset"]}function c(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function l(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function d(t){var n;return t instanceof O?(n=e.createNativeRange(t.getDocument()),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset)):t instanceof _?n=t.nativeRange:H.implementsDomRange&&t instanceof b.getWindow(t.startContainer).Range&&(n=t),n}function u(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;t<n;++t)if(!b.isAncestorOf(e[0],e[t]))return!1;return!0}function f(e){var n=e.getNodes();if(!u(n))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function h(e){return!!e&&void 0!==e.text}function g(e,t){var n=new _(t);e._ranges=[n],s(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function p(t){if(t._ranges.length=0,"None"==t.docSelection.type)l(t);else{var n=t.docSelection.createRange();if(h(n))g(t,n);else{t.rangeCount=n.length;for(var r,o=k(n.item(0)),i=0;i<t.rangeCount;++i)r=e.createRange(o),r.selectNode(n.item(i)),t._ranges.push(r);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,s(t,t._ranges[t.rangeCount-1],!1)}}}function m(e,n){for(var r=e.docSelection.createRange(),o=f(n),i=k(r.item(0)),a=L(i).createControlRange(),s=0,c=r.length;s<c;++s)a.add(r.item(s));try{a.add(o)}catch(e){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}a.select(),p(e)}function v(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function C(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}function R(e,t){for(var n,r,o=Z.length;o--;)if(n=Z[o],r=n.selection,"deleteAll"==t)C(r);else if(n.win==e)return"delete"==t?(Z.splice(o,1),!0):r;return"deleteAll"==t&&(Z.length=0),null}function N(e,n){for(var r,o=k(n[0].startContainer),i=L(o).createControlRange(),a=0,s=n.length;a<s;++a){r=f(n[a]);try{i.add(r)}catch(e){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}i.select(),p(e)}function E(e,t){if(e.win.document!=k(t))throw new D("WRONG_DOCUMENT_ERR")}function y(t){return function(n,r){var o;this.rangeCount?(o=this.getRangeAt(0),o["set"+(t?"Start":"End")](n,r)):(o=e.createRange(this.win.document),o.setStartAndEnd(n,r)),this.setSingleRange(o,this.isBackward())}}function T(e){var t=[],n=new P(e.anchorNode,e.anchorOffset),r=new P(e.focusNode,e.focusOffset),o="function"==typeof e.getName?e.getName():"Selection";if(void 0!==e.rangeCount)for(var i=0,a=e.rangeCount;i<a;++i)t[i]=O.inspect(e.getRangeAt(i));return"["+o+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+r.inspect()+"]"}e.config.checkSelectionRanges=!0;var S,w,b=e.dom,A=e.util,x=A.isHostMethod,O=e.DomRange,_=e.WrappedRange,D=e.DOMException,P=b.DomPosition,H=e.features,k=b.getDocument,L=b.getBody,M=O.rangesEqual,I=x(window,"getSelection"),B=A.isHostObject(document,"selection");H.implementsWinGetSelection=I,H.implementsDocSelection=B;var W=B&&(!I||e.config.preferTextRange);if(W)S=i,e.isSelectionValid=function(e){var t=r(e,"isSelectionValid").document,n=t.selection;return"None"!=n.type||k(n.createRange().parentElement())==t};else{if(!I)return t.fail("Neither document.selection or window.getSelection() detected."),!1;S=o,e.isSelectionValid=function(){return!0}}e.getNativeSelection=S;var U=S();if(!U)return t.fail("Native selection was null (possibly issue 138?)"),!1;var j=e.createNativeRange(document),z=L(document),F=A.areHostProperties(U,["anchorNode","focusNode","anchorOffset","focusOffset"]);H.selectionHasAnchorAndFocus=F;var V=x(U,"extend");H.selectionHasExtend=V;var q="number"==typeof U.rangeCount;H.selectionHasRangeCount=q;var K=!1,Y=!0,$=V?function(t,n){var r=O.getRangeDocument(n),o=e.createRange(r);o.collapseToPoint(n.endContainer,n.endOffset),t.addRange(d(o)),t.extend(n.startContainer,n.startOffset)}:null;A.areHostMethods(U,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof U.rangeCount&&H.implementsDomRange&&function(){var t=window.getSelection();if(t){for(var n=t.rangeCount,r=n>1,o=[],i=a(t),s=0;s<n;++s)o[s]=t.getRangeAt(s);var c=b.createTestElement(document,"",!1),l=c.appendChild(document.createTextNode("   ")),d=document.createRange();if(d.setStart(l,1),d.collapse(!0),t.removeAllRanges(),t.addRange(d),Y=1==t.rangeCount,t.removeAllRanges(),!r){var u=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(u&&parseInt(u[1])>=36)K=!1;else{var f=d.cloneRange();d.setStart(l,0),f.setEnd(l,3),f.setStart(l,2),t.addRange(d),t.addRange(f),K=2==t.rangeCount}}for(b.removeNode(c),t.removeAllRanges(),s=0;s<n;++s)0==s&&i?$?$(t,o[s]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),t.addRange(o[s])):t.addRange(o[s])}}(),H.selectionSupportsMultipleRanges=K,H.collapsedNonEditableSelectionsSupported=Y;var Q,G=!1;z&&x(z,"createControlRange")&&(Q=z.createControlRange(),A.areHostProperties(Q,["item","add"])&&(G=!0)),H.implementsControlRange=G,w=F?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return!!e.rangeCount&&e.getRangeAt(e.rangeCount-1).collapsed};var X;x(U,"getRangeAt")?X=function(e,t){try{return e.getRangeAt(t)}catch(e){return null}}:F&&(X=function(t){var n=k(t.anchorNode),r=e.createRange(n);return r.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),r.collapsed!==this.isCollapsed&&r.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),r}),v.prototype=e.selectionPrototype;var Z=[],J=function(e){if(e&&e instanceof v)return e.refresh(),e;e=r(e,"getNativeSelection");var t=R(e),n=S(e),o=B?i(e):null;return t?(t.nativeSelection=n,t.docSelection=o,t.refresh()):(t=new v(n,o,e),Z.push({win:e,selection:t})),t};e.getSelection=J,A.createAliasForDeprecatedMethod(e,"getIframeSelection","getSelection");var ee=v.prototype;if(!W&&F&&A.areHostMethods(U,["removeAllRanges","addRange"])){ee.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),l(this)};var te=function(e,t){$(e.nativeSelection,t),e.refresh()};ee.addRange=q?function(t,r){if(G&&B&&"Control"==this.docSelection.type)m(this,t);else if(n(r)&&V)te(this,t);else{var o;K?o=this.rangeCount:(this.removeAllRanges(),o=0);var i=d(t).cloneRange();try{this.nativeSelection.addRange(i)}catch(e){}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==o+1){if(e.config.checkSelectionRanges){var a=X(this.nativeSelection,this.rangeCount-1);a&&!M(a,t)&&(t=new _(a))}this._ranges[this.rangeCount-1]=t,s(this,t,oe(this.nativeSelection)),this.isCollapsed=w(this)}else this.refresh()}}:function(e,t){n(t)&&V?te(this,e):(this.nativeSelection.addRange(d(e)),this.refresh())},ee.setRanges=function(e){if(G&&B&&e.length>1)N(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;t<n;++t)this.addRange(e[t])}}}else{if(!(x(U,"empty")&&x(j,"select")&&G&&W))return t.fail("No means of selecting a Range or TextRange was found"),!1;ee.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=k(this.anchorNode);else if("Control"==this.docSelection.type){var t=this.docSelection.createRange();t.length&&(e=k(t.item(0)))}if(e){L(e).createTextRange().select(),this.docSelection.empty()}}}catch(e){}l(this)},ee.addRange=function(t){"Control"==this.docSelection.type?m(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,s(this,t,!1))},ee.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?N(this,e):t&&this.addRange(e[0])}}ee.getRangeAt=function(e){if(e<0||e>=this.rangeCount)throw new D("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()};var ne;if(W)ne=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=L(t.win.document).createTextRange(),n.collapse(!0)),"Control"==t.docSelection.type?p(t):h(n)?g(t,n):l(t)};else if(x(U,"getRangeAt")&&"number"==typeof U.rangeCount)ne=function(t){if(G&&B&&"Control"==t.docSelection.type)p(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var n=0,r=t.rangeCount;n<r;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));s(t,t._ranges[t.rangeCount-1],oe(t.nativeSelection)),t.isCollapsed=w(t)}else l(t)};else{if(!F||"boolean"!=typeof U.isCollapsed||"boolean"!=typeof j.collapsed||!H.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;ne=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=X(n,0),e._ranges=[t],e.rangeCount=1,c(e),e.isCollapsed=w(e)):l(e)}}ee.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,r=this.anchorOffset;if(ne(this),e){var o=t.length;if(o!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=r)return!0;for(;o--;)if(!M(t[o],this._ranges[o]))return!0;return!1}};var re=function(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var r=0,o=n.length;r<o;++r)M(t,n[r])||e.addRange(n[r]);e.rangeCount||l(e)};ee.removeRange=G&&B?function(e){if("Control"==this.docSelection.type){for(var t,n=this.docSelection.createRange(),r=f(e),o=k(n.item(0)),i=L(o).createControlRange(),a=!1,s=0,c=n.length;s<c;++s)t=n.item(s),t!==r||a?i.add(n.item(s)):a=!0;i.select(),p(this)}else re(this,e)}:function(e){re(this,e)};var oe;!W&&F&&H.implementsDomRange?(oe=a,ee.isBackward=function(){return oe(this)}):oe=ee.isBackward=function(){return!1},ee.isBackwards=ee.isBackward,ee.toString=function(){for(var e=[],t=0,n=this.rangeCount;t<n;++t)e[t]=""+this._ranges[t];return e.join("")},ee.collapse=function(t,n){E(this,t);var r=e.createRange(t);r.collapseToPoint(t,n),this.setSingleRange(r),this.isCollapsed=!0},ee.collapseToStart=function(){if(!this.rangeCount)throw new D("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},ee.collapseToEnd=function(){if(!this.rangeCount)throw new D("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},ee.selectAllChildren=function(t){E(this,t);var n=e.createRange(t);n.selectNodeContents(t),this.setSingleRange(n)},ee.deleteFromDocument=function(){if(G&&B&&"Control"==this.docSelection.type){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),b.removeNode(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var r=0,o=n.length;r<o;++r)n[r].deleteContents();this.addRange(n[o-1])}}},ee.eachRange=function(e,t){for(var n=0,r=this._ranges.length;n<r;++n)if(e(this.getRangeAt(n)))return t},ee.getAllRanges=function(){var e=[];return this.eachRange(function(t){e.push(t)}),e},ee.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},ee.callMethodOnEachRange=function(e,t){var n=[];return this.eachRange(function(r){n.push(r[e].apply(r,t||[]))}),n},ee.setStart=y(!0),ee.setEnd=y(!1),e.rangePrototype.select=function(e){J(this.getDocument()).setSingleRange(this,e)},ee.changeEachRange=function(e){var t=[],n=this.isBackward();this.eachRange(function(n){e(n),t.push(n)}),this.removeAllRanges(),n&&1==t.length?this.addRange(t[0],"backward"):this.setRanges(t)},ee.containsNode=function(e,t){return this.eachRange(function(n){return n.containsNode(e,t)},!0)||!1},ee.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},ee.moveToBookmark=function(t){for(var n,r,o=[],i=0;n=t.rangeBookmarks[i++];)r=e.createRange(this.win),r.moveToBookmark(n),o.push(r);t.backward?this.setSingleRange(o[0],"backward"):this.setRanges(o)},ee.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},ee.restoreRanges=function(e){this.removeAllRanges();for(var t,n=0;t=e.ranges[n];++n)this.addRange(t,e.backward&&0==n)},ee.toHtml=function(){var e=[];return this.eachRange(function(t){e.push(O.toHtml(t))}),e.join("")},H.implementsTextRange&&(ee.getNativeTextRange=function(){var n;if(n=this.docSelection){var r=n.createRange();if(h(r))return r;throw t.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return e.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw t.createError("getNativeTextRange: selection contains no range")}),ee.getName=function(){return"WrappedSelection"},ee.inspect=function(){return T(this)},ee.detach=function(){R(this.win,"delete"),C(this)},v.detachAll=function(){R(null,"deleteAll")},v.inspect=T,v.isDirectionBackward=n,e.Selection=v,e.selectionPrototype=ee,e.addShimListener(function(e){void 0===e.getSelection&&(e.getSelection=function(){return J(e)}),e=null})});var B=!1,W=function(e){B||(B=!0,!H.initialized&&H.config.autoInitialize&&u())};return D&&("complete"==document.readyState?W():(e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",W,!1),L(window,"load",W))),H})},function(e,t,n){var r;(function(o,i){"use strict";var a=function(){var e=function(e){return e.replace(/^\s+|\s+$/g,"")},t=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1},n=o.rangy||null,r=o.Undo||null,a=!n||!r,s=o.Key={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capsLock:20,escape:27,pageUp:33,pageDown:34,end:35,home:36,leftArrow:37,upArrow:38,rightArrow:39,downArrow:40,insert:45,delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,leftWindow:91,rightWindowKey:92,select:93,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,subtract:109,decimalPoint:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numLock:144,scrollLock:145,semiColon:186,equalSign:187,comma:188,dash:189,period:190,forwardSlash:191,graveAccent:192,openBracket:219,backSlash:220,closeBraket:221,singleQuote:222},c=function(e){var t,n,r,i=this,l=new c.Action,d=new c.Cache,u=new c.Cursor,f=new c.HtmlAssistant,h=new c.Utilities,g=new c.Selection,p={focus:function(e){e=e||o.event,c.activeElement=t},blur:function(e){e=e||o.event,c.activeElement===t&&(c.activeElement=null),f.placeholders()},down:function(e){e=e||o.event;var t=!0;if(229!==e.keyCode){if(h.isCommand(e,function(){d.cmd=!0},function(){d.cmd=!1}),h.isShift(e,function(){d.shift=!0},function(){d.shift=!1}),h.isModifier(e,function(n){if(d.cmd){if((v.mode===c.inlineMode||v.mode===c.partialMode)&&"paste"!==n)return void h.preventDefaultEvent(e);var r=typeof n,o=null;o="function"===r?n:p.command[n],t=o.call(i,e),!1===t&&(h.preventDefaultEvent(e),h.stopPropagation(e))}}),-1!==v.maxLength){var n=f.text().length,r=!1,a=o.getSelection();if(a&&(r=!a.isCollapsed),n>=v.maxLength&&!h.isSpecial(e)&&!h.isNavigational(e)&&!r)return h.preventDefaultEvent(e)}switch(e.keyCode){case s.enter:p.enterKey(e);break;case s.backspace:case s.delete:p.backspaceOrDeleteKey(e)}return t}},up:function(e){e=e||o.event,h.isCommand(e,function(){d.cmd=!1},function(){d.cmd=!0}),f.clean(),f.placeholders();var t;if(null!==v.keyContext&&(t=v.keyContext[e.keyCode])){var n=u.parent();n&&t.call(i,e,n)}l.preserveElementFocus()},command:{bold:function(e){h.preventDefaultEvent(e),new c.Element(i,"bold").setClean(!1).invoke(v.beforeInvokeElement)},underline:function(e){h.preventDefaultEvent(e),new c.Element(i,"underline").setClean(!1).invoke(v.beforeInvokeElement)},italicize:function(e){h.preventDefaultEvent(e),new c.Element(i,"italic").setClean(!1).invoke(v.beforeInvokeElement)},quote:function(e){},paste:function(e){if(i.makeUndoable(),v.pasteAsText){var t=h.selection.saveSelection();h.pasteHook(function(e){h.selection.restoreSelection(t),e=e.replace(/\n/g,"<br>"),new c.Html(i,e).setClean(!1).insert(v.beforeInsertHtml,!0),f.clean(),f.placeholders()})}else f.clean(),f.placeholders()}},enterKey:function(e){if(v.mode===c.inlineMode)return h.preventDefaultEvent(e);if(!d.shift){var n,r,o,i=f.atCaret()||{},a=t.children,s=i===t.lastChild?t.lastChild:null;s&&s!==t.firstChild&&v.autoHR&&"partial"!==v.mode&&v.tags.horizontalRule&&(h.preventDefaultEvent(e),n=""===f.text(s)&&s.nodeName.toLowerCase()===v.tags.paragraph,n&&a.length>=2&&(r=a[a.length-2],r.nodeName.toLowerCase()===v.tags.horizontalRule&&(n=!1)),n&&(f.addTag(v.tags.horizontalRule,!1,!0,i),i=i.nextSibling),null!==(o=f.addTag(v.tags.paragraph,!0,null,i))&&(o.innerHTML="",u.set(0,o)))}return!0},backspaceOrDeleteKey:function(e){if(null!==t.lastChild){var n=t.lastChild,r=n.previousSibling;n&&v.tags.horizontalRule&&n.nodeName.toLocaleLowerCase()===v.tags.horizontalRule?t.removeChild(n):n&&r&&h.html.text(n).length<1&&r.nodeName.toLowerCase()===v.tags.horizontalRule&&n.nodeName.toLowerCase()===v.tags.paragraph&&(t.removeChild(n),t.removeChild(r))}}},m={element:null,modifier:"auto",placeholder:"",autofocus:!1,autoHR:!0,mode:c.richMode,maxLength:-1,modifiers:{b:"bold",i:"italicize",u:"underline",v:"paste"},tags:{break:"br",horizontalRule:"hr",paragraph:"p",outerLevel:["pre","blockquote","figure"],innerLevel:["a","b","u","i","img","strong"]},cssClasses:{editor:"Medium",pasteHook:"Medium-paste-hook",placeholder:"Medium-placeholder",clear:"Medium-clear"},attributes:{remove:["style","class"]},pasteAsText:!0,beforeInvokeElement:function(){},beforeInsertHtml:function(){},beforeAddTag:function(e,t,n,r){},keyContext:null,pasteEventHandler:function(e){e=e||o.event,i.makeUndoable();var n,r=i.value().length;if(v.pasteAsText){h.preventDefaultEvent(e);var a=h.selection.saveSelection(),s=prompt(c.Messages.pastHere)||"";if(s.length>0)return t.focus(),c.activeElement=t,h.selection.restoreSelection(a),s=f.encodeHtml(s),n=s.length+r,v.maxLength>0&&n>v.maxLength&&(s=s.substring(0,v.maxLength-r)),v.mode!==c.inlineMode&&(s=s.replace(/\n/g,"<br>")),new c.Html(i,s).setClean(!1).insert(v.beforeInsertHtml,!0),f.clean(),f.placeholders(),!1}else setTimeout(function(){f.clean(),f.placeholders()},20)}},v=h.deepExtend(m,e),C={};for(r in m)"object"!=typeof m[r]&&m.hasOwnProperty(r)&&v.element.getAttribute("data-medium-"+s)&&(n=v.element.getAttribute("data-medium-"+s),"false"!==n.toLowerCase()&&"true"!==n.toLowerCase()||(n="true"===n.toLowerCase()),v[r]=n);if(v.modifiers)for(r in v.modifiers)void 0!==s[r]&&(v.modifiers[s[r]]=v.modifiers[r]);if(v.keyContext)for(r in v.keyContext)void 0!==s[r]&&(v.keyContext[s[r]]=v.keyContext[r]);t=v.element,t.contentEditable=!0,t.className+=" "+v.cssClasses.editor+" "+v.cssClasses.editor+"-"+v.mode,v.tags=v.tags||{},v.tags.outerLevel&&(v.tags.outerLevel=v.tags.outerLevel.concat([v.tags.paragraph,v.tags.horizontalRule])),this.settings=v,this.element=t,this.intercept=p,this.action=l,this.cache=d,this.cursor=u,this.html=f,this.utils=h,this.selection=g,C.element=t,C.medium=this,C.settings=v,C.action=l,C.cache=d,C.cursor=u,C.html=f,C.intercept=p,C.utils=h,C.selection=g,l.setBridge(C),d.setBridge(C),u.setBridge(C),f.setBridge(C),h.setBridge(C),g.setBridge(C),f.clean(),f.placeholders(),l.preserveElementFocus(),l.listen(),a?this.makeUndoable=function(){}:(this.dirty=!1,this.undoable=new c.Undoable(this),this.undo=this.undoable.undo,this.redo=this.undoable.redo,this.makeUndoable=this.undoable.makeUndoable),t.medium=this,d.initialized=!0};return c.prototype={insertHtml:function(e,t){var n=new c.Html(this,e).insert(this.settings.beforeInsertHtml);return this.utils.triggerEvent(this.element,"change"),t&&t.apply(n),this},invokeElement:function(e,n){var r=this.settings,n=n||{},o=n.remove||[];switch(r.mode){case c.inlineMode:case c.partialMode:return this}return o.length>0&&(t(r,"class")||o.push("class")),new c.Element(this,e,n).invoke(this.settings.beforeInvokeElement),this.utils.triggerEvent(this.element,"change"),this},behavior:function(){return a?"wild":"domesticated"},value:function(e){return void 0===e?this.element.innerHTML:(this.element.innerHTML=e,this.html.clean(),this.html.placeholders(),this)},focus:function(){return this.element.focus(),this},select:function(){var e,t,n=this.element;return n.focus(),i.body.createTextRange?(e=i.body.createTextRange(),e.moveToElementText(n),e.select()):o.getSelection&&(t=o.getSelection(),e=i.createRange(),e.selectNodeContents(n),t.removeAllRanges(),t.addRange(e)),this},isActive:function(){return c.activeElement===this.element},destroy:function(){var t=this.element,n=this.intercept,r=this.settings,o=this.placeholder||null;null!==o&&o.setup&&(o.parentNode.removeChild(o),delete t.placeHolderActive),t.removeAttribute("contenteditable"),t.className=e(t.className.replace(r.cssClasses.editor,"").replace(r.cssClasses.clear,"").replace(r.cssClasses.editor+"-"+r.mode,"")),this.utils.removeEvent(t,"keyup",n.up).removeEvent(t,"keydown",n.down).removeEvent(t,"focus",n.focus).removeEvent(t,"blur",n.focus).removeEvent(t,"paste",r.pasteEventHandler)},clear:function(){this.element.innerHTML="",this.html.placeholders()}},c.Element=function(e,t,n){if(this.medium=e,this.element=e.settings.element,a)this.tagName=t;else switch(t.toLowerCase()){case"bold":this.tagName="b";break;case"italic":this.tagName="i";break;case"underline":this.tagName="u";break;default:this.tagName=t}this.attributes=n||{},this.clean=!0},c.Html=function(e,t){this.medium=e,this.element=e.settings.element,this.html=t,this.clean=!0},c.Injector=function(){},a?(c.Element.prototype={invoke:function(e){c.activeElement===this.element&&(e&&e.apply(this),i.execCommand(this.tagName,!1))},setClean:function(){return this}},c.Injector.prototype={inject:function(e,t){return this.insertHTML(e,t),null}},c.Undoable=function(){}):(n.rangePrototype.insertNodeAtEnd=function(e){var t=this.cloneRange();t.collapse(!1),t.insertNode(e),t.detach(),this.setEndAfter(e)},c.Element.prototype={invoke:function(e){if(c.activeElement===this.element){e&&e.apply(this);var t,r,i=this.attributes,a=this.tagName.toLowerCase();void 0!==i.className?(r=(i.className.split[" "]||[i.className]).shift(),delete i.className):r="medium-"+a,t=n.createClassApplier(r,{elementTagName:a,elementAttributes:this.attributes}),this.medium.makeUndoable(),t.toggleSelection(o),this.clean&&(this.medium.html.clean(),this.medium.html.placeholders())}},setClean:function(e){return this.clean=e,this}},c.Injector.prototype={inject:function(e){var t,n=!1;if("string"==typeof e){var r=i.createElement("div");r.innerHTML=e,t=r.childNodes,n=!0}else t=e;this.insertHTML('<span id="wedge"></span>');var o=i.getElementById("wedge"),a=o.parentNode;if(o.removeAttribute("id"),n)for(;0<t.length;)a.insertBefore(t[0],o);else a.insertBefore(t,o);return a.removeChild(o),o=null,t}},c.Undoable=function(e){var t,n=this,r=e.settings.element,o=e.utils,i=o.addEvent,a=r.innerHTML,c=new Undo.Stack,l=Undo.Command.extend({constructor:function(e,t){this.oldValue=e,this.newValue=t},execute:function(){},undo:function(){r.innerHTML=this.oldValue,e.canUndo=c.canUndo(),e.canRedo=c.canRedo(),e.dirty=c.dirty()},redo:function(){r.innerHTML=this.newValue,e.canUndo=c.canUndo(),e.canRedo=c.canRedo(),e.dirty=c.dirty()}}),d=function(){var t=r.innerHTML;t!=a&&(n.movingThroughStack||(c.execute(new l(a,t)),a=t,e.dirty=c.dirty()),o.triggerEvent(e.settings.element,"change"))};this.medium=e,this.timer=t,this.stack=c,this.makeUndoable=d,this.EditCommand=l,this.movingThroughStack=!1,i(r,"keyup",function(e){if(e.ctrlKey||e.keyCode===s.z)return void o.preventDefaultEvent(e);clearTimeout(t),t=setTimeout(function(){d()},250)}),i(r,"keydown",function(e){if(!e.ctrlKey||e.keyCode!==s.z)return n.movingThroughStack=!1,!0;o.preventDefaultEvent(e),n.movingThroughStack=!0,e.shiftKey?c.canRedo()&&c.redo():c.canUndo()&&c.undo()})}),c.Injector.prototype.insertHTML=function(e,t){var n,r;if(o.getSelection){if(n=o.getSelection(),n.getRangeAt&&n.rangeCount){r=n.getRangeAt(0),r.deleteContents();var a=i.createElement("div");a.innerHTML=e;for(var s,c,l=i.createDocumentFragment();s=a.firstChild;)c=l.appendChild(s);var d=l.firstChild;r.insertNode(l),c&&(r=r.cloneRange(),r.setStartAfter(c),t?r.setStartBefore(d):r.collapse(!0),n.removeAllRanges(),n.addRange(r))}}else if((n=i.selection)&&"Control"!=n.type){var u=n.createRange();u.collapse(!0),n.createRange().pasteHTML(e),t&&(r=n.createRange(),r.setEndPoint("StartToStart",u),r.select())}},c.Html.prototype={setBridge:function(e){for(var t in e)this[t]=e[t]},insert:function(e,t){if(c.activeElement===this.element){e&&e.apply(this);var n=this.injector.inject(this.html,t);return this.clean&&(this.medium.html.clean(),this.medium.html.placeholders()),this.medium.makeUndoable(),n}return null},injector:new c.Injector,setClean:function(e){return this.clean=e,this}},c.Utilities=function(){},c.Utilities.prototype={setBridge:function(e){for(var t in e)this[t]=e[t]},isCommand:function(e,t,n){var r=this.settings;return"ctrl"===r.modifier&&e.ctrlKey||"cmd"===r.modifier&&e.metaKey||"auto"===r.modifier&&(e.ctrlKey||e.metaKey)?t.call():n.call()},isShift:function(e,t,n){return e.shiftKey?t.call():n.call()},isModifier:function(e,t){var n=this.settings.modifiers[e.keyCode];return!!n&&t.call(null,n)},special:function(){var e={};return e[s.backspace]=!0,e[s.shift]=!0,e[s.ctrl]=!0,e[s.alt]=!0,e[s.delete]=!0,e[s.cmd]=!0,e}(),isSpecial:function(e){return!!this.cache.cmd||void 0!==this.special[e.keyCode]},navigational:function(){var e={};return e[s.upArrow]=!0,e[s.downArrow]=!0,e[s.leftArrow]=!0,e[s.rightArrow]=!0,e}(),isNavigational:function(e){return void 0!==this.navigational[e.keyCode]},addEvent:function(e,t,n){return e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n,this},removeEvent:function(e,t,n){return e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=null,this},preventDefaultEvent:function(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,this},stopPropagation:function(e){e=e||window.event,e.cancelBubble=!0,void 0!==e.stopPropagation&&e.stopPropagation()},triggerEvent:function(e,t){var n;return i.createEvent?(n=i.createEvent("HTMLEvents"),n.initEvent(t,!0,!0),n.eventName=t,e.dispatchEvent(n)):(n=i.createEventObject(),e.fireEvent("on"+t,n)),this},deepExtend:function(e,t){for(var n in t)t[n]&&t[n].constructor&&t[n].constructor===Object?(e[n]=e[n]||{},this.deepExtend(e[n],t[n])):e[n]=t[n];return e},pasteHook:function(e){var t,n,r,o=i.createElement("textarea"),s=this.element,c=this.settings,l=this.medium,d=this.html;o.className=c.cssClasses.pasteHook,s.parentNode.appendChild(o),o.focus(),a||l.makeUndoable(),setTimeout(function(){s.focus(),c.maxLength>0&&(t=d.text(s),n=t.length,(r=n+o.value.length)>n&&(o.value=o.value.substring(0,c.maxLength-n))),e(o.value),d.deleteNode(o)},2)},setupContents:function(){var e,t=this.element,n=t.children,r=t.childNodes;!this.settings.tags.paragraph||n.length>0||this.settings.mode===c.inlineMode||(r.length>0?(e=i.createElement(this.settings.tags.paragraph),t.innerHTML.match("^[&]nbsp[;]")&&(t.innerHTML=t.innerHTML.substring(6,t.innerHTML.length-1)),e.innerHTML=t.innerHTML,t.innerHTML="",t.appendChild(e),this.cursor.set(e.innerHTML.length,e)):(e=i.createElement(this.settings.tags.paragraph),e.innerHTML="&nbsp;",t.appendChild(e)))},traverseAll:function(e,t,n){var r,o=e.childNodes,i=o.length,a=0,n=n||1;if(t=t||{},i>0)for(;a<i;a++){switch(r=o[a],r.nodeType){case 1:this.traverseAll(r,t,n+1),void 0!==t.element&&t.element(r,a,n,e);break;case 3:void 0!==t.fragment&&t.fragment(r,a,n,e)}i=o.length,r===e.lastChild&&(a=i)}}},c.Selection=function(){},c.Selection.prototype={setBridge:function(e){for(var t in e)this[t]=e[t]},saveSelection:function(){if(o.getSelection){var e=o.getSelection();if(e.rangeCount>0)return e.getRangeAt(0)}else if(i.selection&&i.selection.createRange)return i.selection.createRange();return null},restoreSelection:function(e){if(e)if(o.getSelection){var t=o.getSelection();t.removeAllRanges(),t.addRange(e)}else i.selection&&e.select&&e.select()}},c.Cursor=function(){},c.Cursor.prototype={setBridge:function(e){for(var t in e)this[t]=e[t]},set:function(e,t){var n,r=this.html;if(i.createRange){var a=o.getSelection(),s=r.lastChild(),c=r.text(s).length-1,l=t||s,d=void 0!==e&&null!==e?e:c;n=i.createRange(),n.setStart(l,d),n.collapse(!0),a.removeAllRanges(),a.addRange(n)}else n=i.body.createTextRange(),n.moveToElementText(t),n.collapse(!1),n.select()},parent:function(){var e,t=null;return o.getSelection?(e=o.getSelection().getRangeAt(0),t=e.commonAncestorContainer,t=1===t.nodeType?t:t.parentNode):i.selection&&(t=i.selection.createRange().parentElement()),"SPAN"==t.tagName&&(t=t.parentNode),t},caretToBeginning:function(e){this.set(0,e)},caretToEnd:function(e){this.set(this.html.text(e).length,e)}},c.HtmlAssistant=function(){},c.HtmlAssistant.prototype={setBridge:function(e){for(var t in e)this[t]=e[t]},encodeHtml:function(e){return i.createElement("a").appendChild(i.createTextNode(e)).parentNode.innerHTML},text:function(t,n){if(t=t||this.settings.element,n)t.textContent&&void 0!==t.textContent?t.textContent=n:t.innerText=n;else{if(t.innerText)return e(t.innerText);if(t.textContent)return e(t.textContent);if(t.data)return e(t.data)}return""},changeTag:function(e,t){var n,r,o=i.createElement(t);for(n=e.firstChild;n;)r=n.nextSibling,o.appendChild(n),n=r;return e.parentNode.insertBefore(o,e),e.parentNode.removeChild(e),o},deleteNode:function(e){e.parentNode.removeChild(e)},placeholders:function(){if(o.getComputedStyle){var t=this.settings,n=this.medium.placeholder||(this.medium.placeholder=i.createElement("div")),r=t.element,a=n.style,s=o.getComputedStyle(r,null),l=function(e){return s.getPropertyValue(e)},d=this.utils,u=d.html.text(r),f=this.cursor,h=r.children.length;if(r.placeholder=n,u.length<1&&h<2){if(r.placeHolderActive)return;r.innerHTML.match("<"+t.tags.paragraph)||(r.innerHTML=""),t.placeholder.length>0&&(n.setup||(n.setup=!0,a.background=l("background"),a.backgroundColor=l("background-color"),a.fontSize=l("font-size"),a.color=s.color,a.marginTop=l("margin-top"),a.marginBottom=l("margin-bottom"),a.marginLeft=l("margin-left"),a.marginRight=l("margin-right"),a.paddingTop=l("padding-top"),a.paddingBottom=l("padding-bottom"),a.paddingLeft=l("padding-left"),a.paddingRight=l("padding-right"),a.borderTopWidth=l("border-top-width"),a.borderTopColor=l("border-top-color"),a.borderTopStyle=l("border-top-style"),a.borderBottomWidth=l("border-bottom-width"),a.borderBottomColor=l("border-bottom-color"),a.borderBottomStyle=l("border-bottom-style"),a.borderLeftWidth=l("border-left-width"),a.borderLeftColor=l("border-left-color"),a.borderLeftStyle=l("border-left-style"),a.borderRightWidth=l("border-right-width"),a.borderRightColor=l("border-right-color"),a.borderRightStyle=l("border-right-style"),n.className=t.cssClasses.placeholder+" "+t.cssClasses.placeholder+"-"+t.mode,n.innerHTML="<div>"+t.placeholder+"</div>",r.parentNode.insertBefore(n,r)),r.className+=" "+t.cssClasses.clear,a.display="",a.minHeight=r.clientHeight+"px",a.minWidth=r.clientWidth+"px",t.mode!==c.inlineMode&&(d.setupContents(),0===h&&r.firstChild&&f.set(0,r.firstChild))),r.placeHolderActive=!0}else r.placeHolderActive&&(r.placeHolderActive=!1,a.display="none",r.className=e(r.className.replace(t.cssClasses.clear,"")),d.setupContents())}},clean:function(e){var t,n,r,i=this.settings,a=i.cssClasses.placeholder,s=(i.attributes||{}).remove||[],c=i.tags||{},l=c.outerLevel||null,d=c.innerLevel||null,u={},f={},h=(c.paragraph||"").toUpperCase(),g=this.html;if(e=e||i.element,null!==l)for(r=0;r<l.length;r++)u[l[r].toUpperCase()]=!0;if(null!==d)for(r=0;r<d.length;r++)f[d[r].toUpperCase()]=!0;this.utils.traverseAll(e,{element:function(e,i,c,p){var m=e.nodeName,v=!0;for(r=0;r<s.length;r++)t=s[r],e.hasAttribute(t)&&e.getAttribute(t)!==a&&e.removeAttribute(t);if((null!==l||null!==d)&&(1===c&&void 0!==u[m]?v=!1:c>1&&void 0!==f[m]&&(v=!1),v))if("block"===o.getComputedStyle(e,null).getPropertyValue("display")){if(h.length>0&&h!==m&&g.changeTag(e,h),c>1)for(;p.childNodes.length>i;)p.parentNode.insertBefore(p.lastChild,p.nextSibling)}else switch(m){case"BR":if(e===e.parentNode.lastChild){if(e===e.parentNode.firstChild)break;n=document.createTextNode(""),n.innerHTML="&nbsp",p.insertBefore(n,e);break}default:for(;null!==e.firstChild;)p.insertBefore(e.firstChild,e);g.deleteNode(e)}}})},lastChild:function(){return this.element.lastChild},addTag:function(e,t,n,r){if(!this.settings.beforeAddTag(e,t,n,r)){var o,a=i.createElement(e);return void 0!==n&&!1===n&&(a.contentEditable=!1),0==a.innerHTML.length&&(a.innerHTML=" "),r&&r.nextSibling?(r.parentNode.insertBefore(a,r.nextSibling),o=r.nextSibling):(this.settings.element.appendChild(a),o=this.html.lastChild()),t&&(this.cache.focusedElement=o,this.cursor.set(0,o)),a}return null},baseAtCaret:function(){if(!this.medium.isActive())return null;var e=o.getSelection?o.getSelection():document.selection;if(e.rangeCount){var t=e.getRangeAt(0),n=t.endContainer;switch(n.nodeType){case 3:if(n.data&&n.data.length!=t.endOffset)return!1}return n}return null},atCaret:function(){var e=this.baseAtCaret()||{},t=this.element;if(!1===e)return null;for(;e&&e.parentNode!==t;)e=e.parentNode;return e&&1==e.nodeType?e:null}},c.Action=function(){},c.Action.prototype={setBridge:function(e){for(var t in e)this[t]=e[t]},listen:function(){var e=this.element,t=this.intercept;this.utils.addEvent(e,"keyup",t.up).addEvent(e,"keydown",t.down).addEvent(e,"focus",t.focus).addEvent(e,"blur",t.blur).addEvent(e,"paste",this.settings.pasteEventHandler)},preserveElementFocus:function(){var e=o.getSelection?o.getSelection().anchorNode:i.activeElement;if(e){var t,n=this.medium.cache,r=this.settings,a=e.parentNode,s=r.element.children,c=a!==n.focusedElement,l=0;for(a===r.element&&(a=e),t=0;t<s.length;t++)if(a===s[t]){l=t;break}c&&(n.focusedElement=a,n.focusedElementIndex=l)}}},c.Cache=function(){this.initialized=!1,this.cmd=!1,this.focusedElement=null},c.Cache.prototype={setBridge:function(e){for(var t in e)this[t]=e[t]}},c.inlineMode="inline",c.partialMode="partial",c.richMode="rich",c.Messages={pastHere:"Paste Here"},c}();void 0!==(r=function(){return a}.call(t,n,t,e))&&(e.exports=r)}).call(this,window,document)},function(e,t,n){n(3);const r=n(1);new r({element:document.querySelector("#post-form .post-form__heading-content"),placeholder:"Title",mode:r.partialMode}),new r({element:document.querySelector("#post-form .post-form__author-content"),placeholder:"Your name",mode:r.inlineMode}),new r({element:document.querySelector("#post-form .post-form__story-content"),placeholder:"Your story"})},function(e,t,n){window.rangy=n(0),n(4),window.undo=n(5),window.Medium=n(1),n(6),n(7),n(8)},function(e,t,n){var r,o,a;!function(i,s){o=[n(0)],r=i,void 0!==(a="function"==typeof r?r.apply(t,o):r)&&(e.exports=a)}(function(e){return e.createModule("ClassApplier",["WrappedSelection"],function(e,t){function n(e,t){for(var n in e)if(e.hasOwnProperty(n)&&!1===t(n,e[n]))return!1;return!0}function r(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function o(e,t){return!!e&&new RegExp("(?:^|\\s)"+t+"(?:\\s|$)").test(e)}function a(e,t){return"object"==typeof e.classList?e.classList.contains(t):o("string"==typeof e.className?e.className:e.getAttribute("class"),t)}function s(e,t){if("object"==typeof e.classList)e.classList.add(t);else{var n="string"==typeof e.className,r=n?e.className:e.getAttribute("class");r?o(r,t)||(r+=" "+t):r=t,n?e.className=r:e.setAttribute("class",r)}}function c(e){return"string"==typeof e.className?e.className:e.getAttribute("class")}function l(e){return e&&e.split(/\s+/).sort().join(" ")}function d(e){return l(c(e))}function u(e,t){return d(e)==d(t)}function f(e,t){for(var n=t.split(/\s+/),o=0,i=n.length;o<i;++o)if(!a(e,r(n[o])))return!1;return!0}function h(e){var t=e.parentNode;return t&&1==t.nodeType&&!/^(textarea|style|script|select|iframe)$/i.test(t.nodeName)}function g(e,t,n,r,o){var i=e.node,a=e.offset,s=i,c=a;i==r&&a>o&&++c,i!=t||a!=n&&a!=n+1||(s=r,c+=o-n),i==t&&a>n+1&&--c,e.node=s,e.offset=c}function p(e,t,n){e.node==t&&e.offset>n&&--e.offset}function m(e,t,n,r){-1==n&&(n=t.childNodes.length);var o=e.parentNode,i=I.getNodeIndex(e);j(r,function(e){g(e,o,i,t,n)}),t.childNodes.length==n?t.appendChild(e):t.insertBefore(e,t.childNodes[n])}function v(e,t){var n=e.parentNode,r=I.getNodeIndex(e);j(t,function(e){p(e,n,r)}),I.removeNode(e)}function C(e,t,n,r,o){for(var i,a=[];i=e.firstChild;)m(i,t,n++,o),a.push(i);return r&&v(e,o),a}function R(e,t){return C(e,e.parentNode,I.getNodeIndex(e),!0,t)}function N(e,t){var n=e.cloneRange();n.selectNodeContents(t);var r=n.intersection(e);return""!=(r?r.toString():"")}function E(e){for(var t,n=e.getNodes([3]),r=0;(t=n[r])&&!N(e,t);)++r;for(var o=n.length-1;(t=n[o])&&!N(e,t);)--o;return n.slice(r,o+1)}function y(e,t){if(e.attributes.length!=t.attributes.length)return!1;for(var n,r,o,i=0,a=e.attributes.length;i<a;++i)if(n=e.attributes[i],"class"!=(o=n.name)){if(r=t.attributes.getNamedItem(o),null===n!=(null===r))return!1;if(n.specified!=r.specified)return!1;if(n.specified&&n.nodeValue!==r.nodeValue)return!1}return!0}function T(e,t){for(var n,r=0,o=e.attributes.length;r<o;++r)if(n=e.attributes[r].name,(!t||!W(t,n))&&e.attributes[r].specified&&"class"!=n)return!0;return!1}function S(e){var t;return e&&1==e.nodeType&&((t=e.parentNode)&&9==t.nodeType&&"on"==t.designMode||q(e)&&!q(e.parentNode))}function w(e){return(q(e)||1!=e.nodeType&&q(e.parentNode))&&!S(e)}function b(e){return e&&1==e.nodeType&&!K.test(V(e,"display"))}function A(e){if(0==e.data.length)return!0;if(Y.test(e.data))return!1;switch(V(e.parentNode,"whiteSpace")){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(e.data))return!1}return b(e.previousSibling)||b(e.nextSibling)}function x(e){var t,n,r=[];for(t=0;n=e[t++];)r.push(new B(n.startContainer,n.startOffset),new B(n.endContainer,n.endOffset));return r}function O(e,t){for(var n,r,o,i=0,a=e.length;i<a;++i)n=e[i],r=t[2*i],o=t[2*i+1],n.setStartAndEnd(r.node,r.offset,o.node,o.offset)}function _(e,t){return I.isCharacterDataNode(e)?0==t?!!e.previousSibling:t!=e.length||!!e.nextSibling:t>0&&t<e.childNodes.length}function D(e,n,r,o){var i,a,s=0==r;if(I.isAncestorOf(n,e))return e;if(I.isCharacterDataNode(n)){var c=I.getNodeIndex(n);if(0==r)r=c;else{if(r!=n.length)throw t.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+r+" in "+n.data);r=c+1}n=n.parentNode}if(_(n,r)){i=n.cloneNode(!1),a=n.parentNode,i.id&&i.removeAttribute("id");for(var l,d=0;l=n.childNodes[r];)m(l,i,d++,o);return m(i,a,I.getNodeIndex(n)+1,o),n==e?i:D(e,a,I.getNodeIndex(i),o)}if(e!=n){i=n.parentNode;var u=I.getNodeIndex(n);return s||u++,D(e,i,u,o)}return e}function P(e,t){return e.namespaceURI==t.namespaceURI&&e.tagName.toLowerCase()==t.tagName.toLowerCase()&&u(e,t)&&y(e,t)&&"inline"==V(e,"display")&&"inline"==V(t,"display")}function H(e){var t=e?"nextSibling":"previousSibling";return function(n,r){var o=n.parentNode,i=n[t];if(i){if(i&&3==i.nodeType)return i}else if(r&&(i=o[t])&&1==i.nodeType&&P(o,i)){var a=i[e?"firstChild":"lastChild"];if(a&&3==a.nodeType)return a}return null}}function k(e){this.isElementMerge=1==e.nodeType,this.textNodes=[];var t=this.isElementMerge?e.lastChild:e;t&&(this.textNodes[0]=t)}function L(e,t,o){var i,a,s,c,d=this;d.cssClass=d.className=e;var u=null,f={};if("object"==typeof t&&null!==t){for(void 0!==t.elementTagName&&(t.elementTagName=t.elementTagName.toLowerCase()),o=t.tagNames,u=t.elementProperties,f=t.elementAttributes,a=0;c=G[a++];)t.hasOwnProperty(c)&&(d[c]=t[c]);i=t.normalize}else i=t;d.normalize=void 0===i||i,d.attrExceptions=[];var h=document.createElement(d.elementTagName);d.elementProperties=d.copyPropertiesToElement(u,h,!0),n(f,function(e,t){d.attrExceptions.push(e),f[e]=""+t}),d.elementAttributes=f,d.elementSortedClassName=d.elementProperties.hasOwnProperty("className")?l(d.elementProperties.className+" "+e):e,d.applyToAnyTagName=!1;var g=typeof o;if("string"==g)"*"==o?d.applyToAnyTagName=!0:d.tagNames=r(o.toLowerCase()).split(/\s*,\s*/);else if("object"==g&&"number"==typeof o.length)for(d.tagNames=[],a=0,s=o.length;a<s;++a)"*"==o[a]?d.applyToAnyTagName=!0:d.tagNames.push(o[a].toLowerCase());else d.tagNames=[d.elementTagName]}function M(e,t,n){return new L(e,t,n)}var I=e.dom,B=I.DomPosition,W=I.arrayContains,U=e.util,j=U.forEach,z=U.isHostMethod(document,"createElementNS"),F=function(){function e(e,t,n){return t&&n?" ":""}return function(t,n){if("object"==typeof t.classList)t.classList.remove(n);else{var r="string"==typeof t.className,o=r?t.className:t.getAttribute("class");o=o.replace(new RegExp("(^|\\s)"+n+"(\\s|$)"),e),r?t.className=o:t.setAttribute("class",o)}}}(),V=I.getComputedStyleProperty,q=function(){return"boolean"==typeof document.createElement("div").isContentEditable?function(e){return e&&1==e.nodeType&&e.isContentEditable}:function(e){return!(!e||1!=e.nodeType||"false"==e.contentEditable)&&("true"==e.contentEditable||q(e.parentNode))}}(),K=/^inline(-block|-table)?$/i,Y=/[^\r\n\t\f \u200B]/,$=H(!1),Q=H(!0);k.prototype={doMerge:function(e){var t=this.textNodes,n=t[0];if(t.length>1){var r,o=I.getNodeIndex(n),i=[],a=0;j(t,function(t,s){r=t.parentNode,s>0&&(r.removeChild(t),r.hasChildNodes()||I.removeNode(r),e&&j(e,function(e){e.node==t&&(e.node=n,e.offset+=a),e.node==r&&e.offset>o&&--e.offset==o+1&&s<len-1&&(e.node=n,e.offset=a)})),i[s]=t.data,a+=t.data.length}),n.data=i.join("")}return n.data},getLength:function(){for(var e=this.textNodes.length,t=0;e--;)t+=this.textNodes[e].length;return t},toString:function(){var e=[];return j(this.textNodes,function(t,n){e[n]="'"+t.data+"'"}),"[Merge("+e.join(",")+")]"}};var G=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements","onElementCreate"],X={};L.prototype={elementTagName:"span",elementProperties:{},elementAttributes:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,useExistingElements:!0,removeEmptyElements:!0,onElementCreate:null,copyPropertiesToElement:function(e,t,n){var r,o,i,a,c,d,u={};for(var f in e)if(e.hasOwnProperty(f))if(a=e[f],c=t[f],"className"==f)s(t,a),s(t,this.className),t[f]=l(t[f]),n&&(u[f]=a);else if("style"==f){o=c,n&&(u[f]=i={});for(r in e[f])e[f].hasOwnProperty(r)&&(o[r]=a[r],n&&(i[r]=o[r]));this.attrExceptions.push(f)}else t[f]=a,n&&(u[f]=t[f],d=X.hasOwnProperty(f)?X[f]:f,this.attrExceptions.push(d));return n?u:""},copyAttributesToElement:function(e,t){for(var n in e)e.hasOwnProperty(n)&&!/^class(?:Name)?$/i.test(n)&&t.setAttribute(n,e[n])},appliesToElement:function(e){return W(this.tagNames,e.tagName.toLowerCase())},getEmptyElements:function(e){var t=this;return e.getNodes([1],function(e){return t.appliesToElement(e)&&!e.hasChildNodes()})},hasClass:function(e){return 1==e.nodeType&&(this.applyToAnyTagName||this.appliesToElement(e))&&a(e,this.className)},getSelfOrAncestorWithClass:function(e){for(;e;){if(this.hasClass(e))return e;e=e.parentNode}return null},isModifiable:function(e){return!this.applyToEditableOnly||w(e)},isIgnorableWhiteSpaceNode:function(e){return this.ignoreWhiteSpace&&e&&3==e.nodeType&&A(e)},postApply:function(e,t,n,r){var o,a,s=e[0],c=e[e.length-1],l=[],d=s,u=c,f=0,h=c.length;j(e,function(e){a=$(e,!r),a?(o||(o=new k(a),l.push(o)),o.textNodes.push(e),e===s&&(d=o.textNodes[0],f=d.length),e===c&&(u=o.textNodes[0],h=o.getLength())):o=null});var g=Q(c,!r);if(g&&(o||(o=new k(c),l.push(o)),o.textNodes.push(g)),l.length){for(i=0,len=l.length;i<len;++i)l[i].doMerge(n);t.setStartAndEnd(d,f,u,h)}},createContainer:function(e){var t,n=I.getDocument(e),r=z&&!I.isHtmlNamespace(e)&&(t=e.namespaceURI)?n.createElementNS(e.namespaceURI,this.elementTagName):n.createElement(this.elementTagName);return this.copyPropertiesToElement(this.elementProperties,r,!1),this.copyAttributesToElement(this.elementAttributes,r),s(r,this.className),this.onElementCreate&&this.onElementCreate(r,this),r},elementHasProperties:function(e,t){var r=this;return n(t,function(t,n){if("className"==t)return f(e,n);if("object"==typeof n){if(!r.elementHasProperties(e[t],n))return!1}else if(e[t]!==n)return!1})},elementHasAttributes:function(e,t){return n(t,function(t,n){if(e.getAttribute(t)!==n)return!1})},applyToTextNode:function(e,t){if(h(e)){var n=e.parentNode;if(1==n.childNodes.length&&this.useExistingElements&&this.appliesToElement(n)&&this.elementHasProperties(n,this.elementProperties)&&this.elementHasAttributes(n,this.elementAttributes))s(n,this.className);else{var r=e.parentNode,o=this.createContainer(r);r.insertBefore(o,e),o.appendChild(e)}}},isRemovable:function(e){return e.tagName.toLowerCase()==this.elementTagName&&d(e)==this.elementSortedClassName&&this.elementHasProperties(e,this.elementProperties)&&!T(e,this.attrExceptions)&&this.elementHasAttributes(e,this.elementAttributes)&&this.isModifiable(e)},isEmptyContainer:function(e){var t=e.childNodes.length;return 1==e.nodeType&&this.isRemovable(e)&&(0==t||1==t&&this.isEmptyContainer(e.firstChild))},removeEmptyContainers:function(e){var t=this,n=e.getNodes([1],function(e){return t.isEmptyContainer(e)}),r=[e],o=x(r);j(n,function(e){v(e,o)}),O(r,o)},undoToTextNode:function(e,t,n,r){if(!t.containsNode(n)){var o=t.cloneRange();o.selectNode(n),o.isPointInRange(t.endContainer,t.endOffset)&&(D(n,t.endContainer,t.endOffset,r),t.setEndAfter(n)),o.isPointInRange(t.startContainer,t.startOffset)&&(n=D(n,t.startContainer,t.startOffset,r))}this.isRemovable(n)?R(n,r):F(n,this.className)},splitAncestorWithClass:function(e,t,n){var r=this.getSelfOrAncestorWithClass(e);r&&D(r,e,t,n)},undoToAncestor:function(e,t){this.isRemovable(e)?R(e,t):F(e,this.className)},applyToRange:function(e,t){var n=this;t=t||[];var r=x(t||[]);e.splitBoundariesPreservingPositions(r),n.removeEmptyElements&&n.removeEmptyContainers(e);var o=E(e);if(o.length){j(o,function(e){n.isIgnorableWhiteSpaceNode(e)||n.getSelfOrAncestorWithClass(e)||!n.isModifiable(e)||n.applyToTextNode(e,r)});var i=o[o.length-1];e.setStartAndEnd(o[0],0,i,i.length),n.normalize&&n.postApply(o,e,r,!1),O(t,r)}var a=n.getEmptyElements(e);j(a,function(e){s(e,n.className)})},applyToRanges:function(e){for(var t=e.length;t--;)this.applyToRange(e[t],e);return e},applyToSelection:function(t){var n=e.getSelection(t);n.setRanges(this.applyToRanges(n.getAllRanges()))},undoToRange:function(e,t){var n=this;t=t||[];var r=x(t);e.splitBoundariesPreservingPositions(r),n.removeEmptyElements&&n.removeEmptyContainers(e,r);var o,i,a=E(e),s=a[a.length-1];if(a.length){n.splitAncestorWithClass(e.endContainer,e.endOffset,r),n.splitAncestorWithClass(e.startContainer,e.startOffset,r);for(var c=0,l=a.length;c<l;++c)o=a[c],(i=n.getSelfOrAncestorWithClass(o))&&n.isModifiable(o)&&n.undoToAncestor(i,r);e.setStartAndEnd(a[0],0,s,s.length),n.normalize&&n.postApply(a,e,r,!0),O(t,r)}var d=n.getEmptyElements(e);j(d,function(e){F(e,n.className)})},undoToRanges:function(e){for(var t=e.length;t--;)this.undoToRange(e[t],e);return e},undoToSelection:function(t){var n=e.getSelection(t),r=e.getSelection(t).getAllRanges();this.undoToRanges(r),n.setRanges(r)},isAppliedToRange:function(e){if(e.collapsed||""==e.toString())return!!this.getSelfOrAncestorWithClass(e.commonAncestorContainer);var t=e.getNodes([3]);if(t.length)for(var n,r=0;n=t[r++];)if(!this.isIgnorableWhiteSpaceNode(n)&&N(e,n)&&this.isModifiable(n)&&!this.getSelfOrAncestorWithClass(n))return!1;return!0},isAppliedToRanges:function(e){var t=e.length;if(0==t)return!1;for(;t--;)if(!this.isAppliedToRange(e[t]))return!1;return!0},isAppliedToSelection:function(t){var n=e.getSelection(t);return this.isAppliedToRanges(n.getAllRanges())},toggleRange:function(e){this.isAppliedToRange(e)?this.undoToRange(e):this.applyToRange(e)},toggleSelection:function(e){this.isAppliedToSelection(e)?this.undoToSelection(e):this.applyToSelection(e)},getElementsWithClassIntersectingRange:function(e){var t=[],n=this;return e.getNodes([3],function(e){var r=n.getSelfOrAncestorWithClass(e);r&&!W(t,r)&&t.push(r)}),t},detach:function(){}},L.util={hasClass:a,addClass:s,removeClass:F,getClass:c,hasSameClasses:u,hasAllClasses:f,replaceWithOwnChildren:R,elementsHaveSameNonClassAttributes:y,elementHasNonClassAttributes:T,splitNodeAt:D,isEditableElement:q,isEditingHost:S,isEditable:w},e.CssClassApplier=e.ClassApplier=L,e.createClassApplier=M,U.createAliasForDeprecatedMethod(e,"createCssClassApplier","createClassApplier",t)}),e})},function(e,t,n){var r,o;(function(){function i(e,t){var n,r;for(n in t)void 0!==(r=t[n])&&(e[n]=r);return e}var a=function(){},s=function(e,t){var n;return n=t&&t.hasOwnProperty("constructor")?t.constructor:function(){return e.apply(this,arguments)},a.prototype=e.prototype,n.prototype=new a,t&&i(n.prototype,t),n.prototype.constructor=n,n.__super__=e.prototype,n},c={version:"0.1.15"};c.Stack=function(){this.commands=[],this.stackPosition=-1,this.savePosition=-1},i(c.Stack.prototype,{execute:function(e){this._clearRedo(),e.execute(),this.commands.push(e),this.stackPosition++,this.changed()},undo:function(){this.commands[this.stackPosition].undo(),this.stackPosition--,this.changed()},canUndo:function(){return this.stackPosition>=0},redo:function(){this.stackPosition++,this.commands[this.stackPosition].redo(),this.changed()},canRedo:function(){return this.stackPosition<this.commands.length-1},save:function(){this.savePosition=this.stackPosition,this.changed()},dirty:function(){return this.stackPosition!=this.savePosition},_clearRedo:function(){this.commands=this.commands.slice(0,this.stackPosition+1)},changed:function(){}}),c.Command=function(e){this.name=e};var l=new Error("override me!");i(c.Command.prototype,{execute:function(){throw l},undo:function(){throw l},redo:function(){this.execute()}}),c.Command.extend=function(e){var t=s(this,e);return t.extend=c.Command.extend,t},r=c,void 0!==(o="function"==typeof r?r.call(t,n,t,e):r)&&(e.exports=o)}).call(this)},function(e,t){},function(e,t){},function(e,t){}]);